[
 {:id :cap/integration/email
  :title "Email provider"
  :version "v1"
  :external-system "SMTP or API provider"
  :contracts {:timeout_ms 3000
              :rate_limit "tbd"}
  :auth {:strategy :env-vars}
  :failure-modes ["timeouts" "rate limits" "invalid recipients"]
 :compatibility {:backward true
                  :forward true
                  :flags []}
  :adapter {:library "tbd"}
  :related {:actions [:cap/action/example-send]
            :schema []}}

 {:id :cap/integration/local-session
  :title "Local session store"
  :version "v1"
  :external-system "Ring session cookie backed by in-memory store"
  :contracts {:store :memory
              :cookie-name "ring-session"
              :cookie-attrs {:http-only true
                             :same-site :lax
                             :path "/"}}
  :auth {:strategy :session-cookie
         :secrets "none (dev-only; plaintext fixtures)"}
  :failure-modes ["Server restart clears sessions" "Missing/expired cookie yields 401 on protected routes"]
  :compatibility {:backward true
                  :forward true
                  :flags []}
 :adapter {:library "ring.middleware.session"
            :notes "Used by :cap/action/auth-login to establish sessions"}
  :related {:actions [:cap/action/auth-login]
            :schema [:cap/schema/user]}}

 {:id :cap/integration/telegram-bot
  :title "Telegram Bot"
  :version "v1"
  :external-system "Telegram Bot API"
  :contracts {:timeout_ms 3000
              :rate_limit "429 from Telegram; backoff with jitter"
              :webhook {:path "/api/telegram/webhook"
                        :secret-header "X-Telegram-Bot-Api-Secret-Token"
                        :enabled-flag "TELEGRAM_WEBHOOK_ENABLED"}
              :commands [:start :help :tasks :task :stop]}
  :auth {:strategy :env-vars
         :vars ["TELEGRAM_BOT_TOKEN" "TELEGRAM_WEBHOOK_SECRET" "TELEGRAM_WEBHOOK_BASE_URL"]}
  :failure-modes ["429 rate limits" "Network timeouts/5xx" "Invalid/missing webhook secret" "Invalid/expired chat link token"]
  :compatibility {:backward true
                  :forward true
                  :flags [:telegram/webhook-enabled? :telegram/notifications-enabled?]}
 :adapter {:library "Telegram Bot API (HTTPS)"
            :notes "Use HTTP client wrapper with stubs; no live Telegram calls in CI"}
 :related {:actions [:cap/action/telegram-send-message
                      :cap/action/telegram-set-webhook
                      :cap/action/telegram-handle-update]
            :schema [:cap/schema/user]}}

 {:id :cap/integration/github
  :title "GitHub API"
  :version "v1"
  :external-system "GitHub REST API"
  :contracts {:base-url "GITHUB_API_URL (default https://api.github.com)"
              :timeout_ms 3000
              :endpoints ["/repos/{owner}/{repo}/pulls"
                          "/repos/{owner}/{repo}/pulls/{number}/commits"]}
  :auth {:strategy :env-vars
         :vars ["GITHUB_TOKEN" "GITHUB_REPO_OWNER" "GITHUB_REPO_NAME"]}
  :failure-modes ["Missing repo config" "Rate limits" "Invalid token" "Network timeouts/5xx"]
  :compatibility {:backward true
                  :forward true
                  :flags []}
  :adapter {:library "clj-http"
            :notes "Reads PR lists and commits; token optional for public repos"}
  :related {:actions [:cap/action/github-pulls]
            :schema []}}

 {:id :cap/integration/rezultati
  :title "Rezultati (mobile)"
  :version "v1"
  :external-system "Rezultati mobile odds pages"
  :contracts {:timeout_ms 3000
              :rate_limit "no explicit headers; treat 403/429 as backoff"
              :endpoints ["/?d={day}&s=5"
                          "/utakmica/{id}/?s=5"]}
  :auth {:strategy :env-vars
         :vars ["REZULTATI_BASE_URL" "REZULTATI_TIMEOUT_MS"]}
  :failure-modes ["Blocked/geo-restricted access" "Network timeouts/5xx" "HTML changes" "Invalid match ids"]
  :compatibility {:backward true
                  :forward true
                  :flags []}
  :adapter {:library "clj-http"
            :notes "On-demand fetch only; no polling or scheduled refresh; no live calls in CI"}
  :related {:actions []
            :schema [:cap/schema/betting-event :cap/schema/betting-quote]}}

 {:id :cap/integration/terminal-service
  :title "Codex Terminal Service"
  :version "v1"
  :external-system "Local terminal session daemon (tmux-backed)"
  :contracts {:transport "HTTP JSON"
              :session-store "EDN file on disk"
              :runtime "tmux + codex CLI"}
  :auth {:strategy :local-only
         :secrets "none (localhost or private network)"}
  :failure-modes ["Terminal service unavailable" "tmux session missing" "Repo clone failures" "Port allocation failure"]
  :compatibility {:backward true
                  :forward true
                  :flags []}
  :adapter {:library "clj-http"
            :notes "Main app proxies requests to the terminal service"}
  :related {:actions [:cap/action/terminal-sessions
                      :cap/action/terminal-session-create
                      :cap/action/terminal-session-input
                      :cap/action/terminal-session-output
                      :cap/action/terminal-session-resume
                      :cap/action/terminal-session-restart-app
                      :cap/action/terminal-session-complete]
            :schema []}}
]
