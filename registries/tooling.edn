[
 {:id :cap/tooling/edn-validate
  :title "Registry EDN validation"
  :version "v1"
  :invocation "scripts/checks.sh registries"
  :scope :shared
  :determinism {:fixtures [:fixtures/users :fixtures/tasks]}
  :enforces [:registry-shape :fixtures-consistency]
  :related {:capabilities [:cap/schema/user :cap/schema/task]}
  :gotchas []}

 {:id :cap/tooling/schema-load
  :title "Schema load check"
  :version "v1"
  :invocation "scripts/checks.sh schema"
 :scope :shared
 :determinism {:fixtures [:fixtures/tasks :fixtures/users]}
 :enforces [:schema]
  :related {:capabilities [:cap/schema/entity :cap/schema/task :cap/schema/user :cap/schema/tag]}
  :gotchas ["Runs against a temp Datomic dev-local DB with :mem storage; run via scripts/checks.sh schema from the repo root."]}

 {:id :cap/tooling/migration-backfill
  :title "Schema migration/backfill check"
  :version "v1"
  :invocation "scripts/checks.sh schema"
  :scope :shared
  :determinism {:fixtures [:fixtures/tasks :fixtures/users :fixtures/tags]}
  :enforces [:schema :migration]
  :related {:capabilities [:cap/schema/entity :cap/schema/task :cap/schema/tag :cap/schema/user]}
  :gotchas ["Runs a temp DB with fixtures, strips :entity/type, then backfills to ensure migration code remains valid."]}

 {:id :cap/tooling/action-contract
  :title "Action contract harness"
  :version "v1"
  :invocation "scripts/checks.sh actions"
  :scope :shared
  :determinism {:fixtures [:fixtures/tasks :fixtures/users]}
  :enforces [:contracts :compatibility]
  :related {:capabilities [:cap/action/task-create
                           :cap/action/task-update
                           :cap/action/task-set-status
                           :cap/action/task-assign
                           :cap/action/task-set-due
                           :cap/action/task-set-tags
                           :cap/action/task-archive
                           :cap/action/auth-login]}
  :gotchas []}

 {:id :cap/tooling/fixtures-loader
  :title "Fixture loader"
  :version "v1"
  :invocation "clojure -M:seed [--temp]"
  :scope :shared
  :determinism {:fixtures [:fixtures/users :fixtures/tasks]}
  :enforces [:fixtures-load]
  :related {:capabilities [:cap/schema/user :cap/schema/task]}
  :gotchas ["Run from repo root; --temp seeds a Datomic dev-local DB in :mem storage by default."]}

 {:id :cap/tooling/app-smoke
  :title "Headless app smoke"
  :version "v1"
  :invocation "scripts/checks.sh app-smoke"
 :scope :shared
 :determinism {:fixtures [:fixtures/tasks :fixtures/users]}
 :enforces [:ui-boot]
 :related {:capabilities [:cap/view/login :cap/view/tasks :cap/view/home]}
  :gotchas ["Requires Playwright Chromium download (handled by scripts/checks.sh); needs outbound network on first run."
            "Seeds a temp Datomic storage under .cpcache/datomic-smoke-*; uses APP_PORT 3100 by default and will kill anything listening there during the smoke run."]}

 {:id :cap/tooling/theme-css-vars
  :title "Theme CSS variable generator"
  :version "v1"
  :invocation "npm run theme:css-vars (scripts/theme-css-vars.sh :theme/default public/css/theme.css)"
  :scope :shared
  :determinism {:fixtures []}
  :enforces [:theme-vars]
  :related {:capabilities [:theme/default]}
  :gotchas []}

 {:id :cap/tooling/import-check
  :title "Land registry import check"
  :version "v1"
  :invocation "scripts/checks.sh import"
  :scope :shared
  :determinism {:fixtures [:fixtures/land-registry-sample]}
  :enforces [:import :schema]
  :related {:capabilities [:cap/action/parcel-import
                           :cap/schema/person
                           :cap/schema/parcel
                           :cap/schema/ownership]}
  :gotchas ["Runs importer against data/land/hrib_parcele_upisane_osobe.csv into a temp Datomic (:mem); dataset must be present."
            "Uses deterministic IDs; reruns are safe. Add --dry-run when calling manually to skip transact."]}

 {:id :cap/tooling/site-process
  :title "Public Site Process"
  :version "v0"
  :invocation {:dev "scripts/run-site.sh" :prod "systemd unit (site)"}
  :scope {:writes? false :reads [:datomic]}
  :determinism :high
  :enforces {:capabilities [:cap/schema/content-page :cap/schema/content-block :cap/schema/content-tag]}
  :compatibility {:backward true :forward true :flags []}}
]
